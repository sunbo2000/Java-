# 进程与线程

![image-20220806111708039](D:\A.学习资料\A.笔记\20. 操作系统\进程与线程.assets\image-20220806111708039.png)

![image-20220806111817774](D:\A.学习资料\A.笔记\20. 操作系统\进程与线程.assets\image-20220806111817774.png)

### 进程

#### 1. 进程模型

1. 进程是程序的一 次执行过程。

2. 进程是一个程序及其数据在处理机上顺序执行时所发生的活动。

3. 进程是具有独立功能的程序在数据集合上运行的过程，它是系统进行资源分配和调度的一一个独立单位

  **强调“动态性”**

在进程模型中,计算机上所有可运行的软件,包括操作系统,被组织成若干顺序进程,简称进程.一个进程就是一个正在执行程序的实例,包括程序计数器,寄存器和变量的当前值.

从概念上来说每个进程拥有自己的虚拟cpu,实际是cpu在多个进程间切换.这种快速切换叫做多道程序设计

程序: 指令序列,静态的

进程: 运行中的程序实例,动态的

#### 2. 进程状态

就绪态: 可运行,但因为没有空闲CPU,而暂时不能运行

运行态: 该进程正在占用cpu

阻塞态: 除非某种外部事件发生,否则进程不能运行

 ![image-20220805122451101](D:\A.学习资料\A.笔记\20. 操作系统\进程与线程.assets\image-20220805122451101.png)

#### 3. 进程通信

进程通信指进程之间信息的交换

进程是分配资源的单位(包括内存地址空间),因此各进程拥有的内存空间相互独立

为了保证安全,一个进程不能直接访问另一个进程的地址空间,但是进程之间的信息交换是必须实现的

**1.共享存储**

基于数据结构的共享(低级)和基于存储区的共享(高级通信方式)

两个进程对共享空间的访问必须是互斥的(互斥访问通过操作系统提供的工具实现)

**2.管道通信**

通过管道半双工通信

各个进程互斥访问管道

管道没写满不允许读,没读完不允许写

3.**消息传递**

结构化传递消息

系统提供发送接收原语

直接通信/间接通信

#### 4. 线程

线程与进程的区别

进程是系统资源分配的基本单位,线程是基本调度单位

引入线程之后线程之间也支持并发

进程间并发需要切换运行环境,系统开销大,线程并发如果是同一进程内则不需要切换进程环境,系统开销小,引入线程后并发带来的系统开销减小

![image-20220805131700263](D:\A.学习资料\A.笔记\20. 操作系统\进程与线程.assets\image-20220805131700263.png)

多线程模型

![image-20220805132208770](D:\A.学习资料\A.笔记\20. 操作系统\进程与线程.assets\image-20220805132208770.png)

![image-20220805132256308](D:\A.学习资料\A.笔记\20. 操作系统\进程与线程.assets\image-20220805132256308.png)

![image-20220805132347844](D:\A.学习资料\A.笔记\20. 操作系统\进程与线程.assets\image-20220805132347844.png)

### 进程同步,进程互斥

同步: 同步是指为了完成某种任务而建立的两个或多个进程，这些进程**因为需要在某些位置上协调它们的工作次序而等待传递信息所产生了制约关系。**

互斥: 互斥是指当一个进程进入临界区使用临界资源的时候，另外一个进程必须等待，当占用临界资源的进程退出临界区后，另外一个进程才允许去访问此临界资源。

#### 进程同步的方法



#### 线程同步的方法

<img src="D:\A.学习资料\A.笔记\20. 操作系统\进程与线程.assets\20171121130628916.png" alt="img" style="zoom: 200%;" />

线程同步的四种方法

1、临界区（Critical Section）:通过对[多线程](https://so.csdn.net/so/search?q=多线程&spm=1001.2101.3001.7020)的串行化来访问公共资源或一段代码，速度快，适合控制数据访问。

优点：保证在某一时刻只有一个线程能访问数据的简便办法

缺点：虽然临界区同步速度很快，但却只能用来同步本进程内的线程，而不可用来同步多个进程中的线程。

 

2、互斥量（Mutex）:为协调共同对一个共享资源的单独访问而设计的。

互斥量跟临界区很相似，比临界区复杂，互斥对象只有一个，只有拥有互斥对象的线程才具有访问资源的权限。

优点：使用互斥不仅仅能够在同一应用程序不同线程中实现资源的安全共享，而且可以在不同应用程序的线程之间实现对资源的安全共享。

缺点：①互斥量是可以命名的，也就是说它可以跨越进程使用，所以创建互斥量需要的资源更多，所以如果只为了在进程内部是用的话使用临界区会带来速度上的优势并能够减少资源占用量。因为互斥量是跨进程的互斥量一旦被创建，就可以通过名字打开它。

②通过互斥量可以指定资源被独占的方式使用，但如果有下面一种情况通过互斥量就无法处理，比如现在一位用户购买了一份三个并发访问许可的数据库系统，可以根据用户购买的访问许可数量来决定有多少个线程/进程能同时进行数据库操作，这时候如果利用互斥量就没有办法完成这个要求，信号量对象可以说是一种资源计数器。

 

3、信号量（Semaphore）:为控制一个具有有限数量用户资源而设计。它允许多个线程在同一时刻访问同一资源，但是需要限制在同一时刻访问此资源的最大线程数目。互斥量是信号量的一种特殊情况，当信号量的最大资源数=1就是互斥量了。

优点：适用于对Socket（套接字）程序中线程的同步。（例如，网络上的HTTP服务器要对同一时间内访问同一页面的用户数加以限制，只有不大于设定的最大用户数目的线程能够进行访问，而其他的访问企图则被挂起，只有在有用户退出对此页面的访问后才有可能进入。）

缺点：①信号量机制必须有公共内存，不能用于分布式操作系统，这是它最大的弱点；

②信号量机制功能强大，但使用时对信号量的操作分散， 而且难以控制，读写和维护都很困难，加重了程序员的编码负担；

③核心操作P-V分散在各用户程序的代码中，不易控制和管理，一旦错误，后果严重，且不易发现和纠正。

 

4、事件（Event）: 用来通知线程有一些事件已发生，从而启动后继任务的开始。

优点：事件对象通过通知操作的方式来保持线程的同步，并且可以实现不同进程中的线程同步操作。

缺点：

 

总结：

①临界区不是内核对象，只能用于进程内部的线程同步，是用户方式的同步。互斥、信号量是内核对象可以用于不同进程之间的线程同步（跨进程同步）。
②互斥其实是信号量的一种特殊形式。互斥可以保证在某一时刻只有一个线程可以拥有临界资源。信号量可以保证在某一时刻有指定数目的线程可以拥有临界资源。
